<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout=http://www.ultraq.net.nz/thymeleaf/layout
      layout:decorate='~{layouts/layout1}'>
<!--타임리프 사용하는거 가져오기-->

<script>
    document.addEventListener("DOMContentLoaded", function() {
      var recentMoviesButton = document.getElementById("recentMoviesButton");

      recentMoviesButton.addEventListener("click", function() {
          // AJAX 요청
          var xhr = new XMLHttpRequest();
          xhr.open("GET", "/movies-top20", true);
          xhr.onreadystatechange = function() {
              if (xhr.readyState === XMLHttpRequest.DONE) {
                  if (xhr.status === 200) {
                      // 서버에서 반환된 데이터를 JSON으로 파싱
                      var recentMovies = JSON.parse(xhr.responseText);

                      // 최신 영화 목록을 동적으로 페이지에 추가하는 작업 수행
                      var moviesListContainer = document.getElementById("moviesList");
                      moviesListContainer.innerHTML = ""; // 기존 목록 초기화
                      recentMovies.forEach(function(movie) {
                          // 각 영화 정보를 HTML로 생성하여 목록에 추가
                          var movieElement = document.createElement("div");
                          movieElement.innerHTML = "<h4>" + movie.title + "</h4>";
                          movieElement.innerHTML += "<p>장르: " + movie.genreName + "</p>";
                          movieElement.innerHTML += "<p>평점: " + movie.score + "</p>";
                          moviesListContainer.appendChild(movieElement);
                      });
                  } else {
                      // 오류 처리
                      console.error("Failed to retrieve recent movies. Status code: " + xhr.status);
                  }
              }
          };
          xhr.send();
      });
  });
</script>


<div layout:fragment="content">
        <!-- Modal Search Start -->
        <div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-fullscreen">
                <div class="modal-content rounded-0">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Search by keyword</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body d-flex align-items-center">
                        <div class="input-group w-75 mx-auto d-flex">
                            <input type="search" class="form-control p-3" placeholder="keywords" aria-describedby="search-icon-1">
                            <span id="search-icon-1" class="input-group-text p-3"><i class="fa fa-search"></i></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal Search End -->


    <!-- Hero Start -->
    <div class="container-fluid py-5 mb-5 hero-header" style="background-image: url(../img/MovieMain.jpg); background-size: 100% 100%; background-position: center; background-repeat: no-repeat; background-color: rgba(255, 255, 255, 0.5);">
        <div class="container py-5" style="position: relative;">
            <div class="row g-5 align-items-center">
                <div class="col-md-12 col-lg-7">
                    <h4 class="mb-3 text-secondary display-6">Attention, Amigos!</h4>
                    <h1 class="mb-5 text-primary display-3">Cinema Connect: Where Film Fans Unite!</h1>
                </div>
                <div class="col-md-12 col-lg-5">
                    <div id="carouselId" class="carousel slide position-relative" data-bs-ride="carousel">
                        <div class="carousel-inner" role="listbox">
                            <div class="carousel-item active rounded">
                                <!-- YouTube 동영상을 배경으로 설정 -->
                                <iframe width="530" height="315" src="https://www.youtube.com/embed/wlCifmmSAD0?si=_l9F3X7__Ysd36Wn" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                            </div>

                            <div class="carousel-item rounded">
                                <!-- YouTube 동영상을 배경으로 설정 -->
                                <iframe width="530" height="315" src="https://www.youtube.com/embed/Xr48xu7yVJo?si=ncwdO0LmLddz-d68" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                            </div>
                        </div>

                        <!-- 예고편 영상에 따른 슬라이드 버튼 마진 조절 -->
                        <button style="margin-left: -60px;" class="carousel-control-prev" type="button" data-bs-target="#carouselId" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>

                        <!-- 예고편 영상에 따른 슬라이드 버튼 마진 조절 -->
                        <button style="margin-right: -60px;" class="carousel-control-next" type="button" data-bs-target="#carouselId" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Hero End -->



        <!-- 영화 리스트 Start-->
        <div class="container-fluid fruite py-5">
            <div class="container py-5">
                <div class="tab-class text-center">
                    <div class="row g-4">
                        <div class="col-lg-4 text-start">
                            <h1>Our Movies</h1>
                        </div>
                        <div class="col-lg-8 text-end">
                            <ul class="nav nav-pills d-inline-flex text-center mb-5">
                                <li class="nav-item">
                                    <a class="d-flex m-2 py-2 bg-light rounded-pill" data-bs-toggle="pill" href="#tab-1">
                                        <span class="text-dark" style="width: 130px;">전체 영화</span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <button id="recentMoviesButton" class="btn btn-primary d-flex py-2 m-2 bg-light rounded-pill" onclick="">최근개봉작</button>
<!--                                    <a class="d-flex py-2 m-2 bg-light rounded-pill" data-bs-toggle="pill" href="/movies-top20">-->
<!--                                        <span class="text-dark" style="width: 130px;">최근개봉작</span>-->
<!--                                    </a>-->
                                </li>
                                <li class="nav-item">
                                    <a class="d-flex m-2 py-2 bg-light rounded-pill" data-bs-toggle="pill" href="#tab-3">
                                        <span class="text-dark" style="width: 130px;">추천 영화</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="tab-content">
                        <div id="tab-1" class="tab-pane fade show p-0 active">
                            <div class="row g-4">
                                <div class="col-lg-12">
                                    <div class="row g-4">
                                        <div class="col-md-6 col-lg-4 col-xl-3" th:each="movie : ${movies}">
                                            <div class="rounded position-relative fruite-item">
                                                <div class="fruite-img">
                                                    <img th:src="${movie.posterImage}" class="img-fluid w-100 rounded-top" alt="">
                                                </div>
                                                <div class="text-white bg-secondary px-3 py-1 rounded position-absolute" style="top: 10px; left: 10px;"th:text="${movie.genreName}"></div>
                                                <div class="p-4 border border-secondary border-top-0 rounded-bottom">
                                                    <a th:href="'/movies/' + ${movie.movieId}"><h5 th:text="${movie.title}" class="text-truncate" style="max-width:320px;"></h5></a>
                                                    <div class="d-flex justify-content-between flex-lg-wrap">
                                                        <a th:href="'/movies/' + ${movie.movieId}"><h4 class="btn border border-secondary rounded-pill px-3 text-primary fa fa-star text-secondary" th:text="${movie.score}"></h4></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="tab-2" class="tab-pane fade show p-0">
                        <div class="row g-4">
                            <div class="col-lg-12">
                                <div class="row g-4">
                                    <div class="col-md-6 col-lg-4 col-xl-3" th:each="recentMovie : ${recentMovies}">
                                        <div class="rounded position-relative fruite-item">
                                            <div class="fruite-img">
                                                <img th:src="${recentMovie.posterImage}" class="img-fluid w-100 rounded-top" alt="">
                                            </div>
                                            <div class="text-white bg-secondary px-3 py-1 rounded position-absolute" style="top: 10px; left: 10px;" th:text="${recentMovie.genreName}"></div>
                                            <div class="p-4 border border-secondary border-top-0 rounded-bottom">
                                                <a th:href="'/movies/' + ${recentMovie.movieId}">
                                                    <h4 th:text="${recentMovie.title}"></h4>
                                                </a>
                                                <div class="d-flex justify-content-between flex-lg-wrap">
                                                    <p class="text-dark fs-5 fw-bold mb-0" th:text="${recentMovie.score}"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
            <!--     end of tab2 -->
<!--                    <div id="tab-3" class="tab-pane fade show p-0">-->
<!--                        <div class="row g-4">-->
<!--                            <div class="col-lg-12">-->
<!--                                <div class="row g-4">-->
<!--                                    <div class="col-md-6 col-lg-4 col-xl-3" th:each="movie : ${movies}">-->
<!--                                        <div class="rounded position-relative fruite-item">-->
<!--                                            <div class="fruite-img">-->
<!--                                                <img th:src="${movie.posterImage}" class="img-fluid w-100 rounded-top" alt="">-->
<!--                                            </div>-->
<!--                                            <div class="text-white bg-secondary px-3 py-1 rounded position-absolute" style="top: 10px; left: 10px;">Fruits</div>-->
<!--                                            <div class="p-4 border border-secondary border-top-0 rounded-bottom">-->
<!--                                                <a th:href="'/movies/' + ${movie.movieId}"><h4 th:text="${movie.title}"></h4></a>-->
<!--                                                <div class="d-flex justify-content-between flex-lg-wrap">-->
<!--                                                    <p class="text-dark fs-5 fw-bold mb-0" th:text="${movie.score}"></p>-->
<!--                                                </div>-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
            <!--  end of tab3-->
                </div>      
            </div>
        </div>
        <!-- 영화리스트 End-->

</div>
</html>